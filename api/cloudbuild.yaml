steps:
# Test including integration test with database container
- name: gcr.io/cloud-builders/docker
  args: ['compose', '-f', 'docker-compose.test.yml', 'up', '--abort-on-container-exit']
  dir: api
# Build image
- name: gcr.io/cloud-builders/docker
  args: ['build', '-t', '$LOCATION-docker.pkg.dev/$PROJECT_ID/containers/api:$COMMIT_SHA', '.']
  dir: api
images:
- $LOCATION-docker.pkg.dev/$PROJECT_ID/containers/api:$COMMIT_SHA